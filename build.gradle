plugins {
    id 'java-library'
    id 'jacoco'
    id "com.jfrog.bintray" version "1.7.3"
    id 'com.github.hierynomus.license' version '0.15.0'
    id 'com.github.sherter.google-java-format' version '0.8'
    id "me.champeau.gradle.jmh" version "0.5.0"
}

repositories {
    jcenter()
}

dependencies {
    testImplementation 'junit:junit:4.13'
    compile group: 'org.assertj', name: 'assertj-core', version: '3.16.1'
}

license {
    mapping {
        java = 'SLASHSTAR_STYLE'
    }
    header = rootProject.file('docs/licenses/HEADER.txt')
    strictCheck = true
    ext.year = Calendar.getInstance().get(Calendar.YEAR)
    ext.name = 'Dynatrace LLC'
}

jacocoTestReport {
    reports {
        xml.enabled true
    }
}

jmh{
    timeout = '10s'
    fork = 2
    timeUnit = 'ms'
    failOnError = false
    timeOnIteration = '1s'
    warmupForks = 0
    warmupIterations = 10
    warmupBatchSize = 1
    warmup = '1s'
    iterations = 50
}

task copyBenchmarkReport(type: Copy) {
    rename ('results.txt', 'results ' + new Date().timeString.replaceAll(":", "-") +'.txt')
    from file("build/reports/jmh/results.txt")
    into file("build/reports/results/" + new Date().dateString)
}

sourceSets{
    jmh
    main
    test
}

tasks.test.finalizedBy jacocoTestReport
tasks.jmh.finalizedBy copyBenchmarkReport